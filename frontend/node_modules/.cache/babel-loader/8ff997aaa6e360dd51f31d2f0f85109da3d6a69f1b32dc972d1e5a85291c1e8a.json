{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from 'react';\nimport { socket } from '../services/socket';\nexport const useChat = () => {\n  _s();\n  const [state, setState] = useState({\n    messages: [],\n    isLoading: false,\n    error: null\n  });\n  const processedTextEventIds = useRef(new Set());\n  const processedAudioEventIds = useRef(new Set());\n  useEffect(() => {\n    socket.connect();\n    setState(prev => ({\n      ...prev,\n      isLoading: true\n    }));\n    socket.on('connect', () => {\n      setState(prev => ({\n        ...prev,\n        isLoading: false\n      }));\n    });\n\n    /*\n    socket.on('audioInputTranscript', (data: any) => {\n      if (data.event_id) {\n        if (processedAudioEventIds.current.has(data.event_id)) {\n          return;\n        }\n        processedAudioEventIds.current.add(data.event_id);\n      }\n       const userMessage: UserMessage = {\n        id: Date.now().toString(),\n        content: data.transcript,\n        role: 'user',\n        timestamp: new Date(),\n      };\n       setState(prev => ({\n        ...prev,\n        messages: [...prev.messages, userMessage],\n      }));\n    });\n     socket.on('textTranscript', (data: any) => {\n      if (processedTextEventIds.current.has(data.event_id)) {\n        return;\n      }\n      processedTextEventIds.current.add(data.event_id);\n       const botMessage: BotMessage = {\n        id: (Date.now() + 1).toString(),\n        content: {\n          message: data.part?.transcript || '(no text)',\n          articles: [],\n        },\n        role: 'assistant',\n        timestamp: new Date(),\n      };\n       setState(prev => ({\n        ...prev,\n        messages: [...prev.messages, botMessage],\n        isLoading: false,\n      }));\n    });\n    */\n\n    socket.on('connect_error', err => {\n      console.error('Socket connect_error:', err);\n      setState(prev => ({\n        ...prev,\n        error: 'Unable to connect to Socket.io',\n        isLoading: false\n      }));\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n  const sendMessage = text => {\n    if (!socket.connected) {\n      console.error('Socket is not connected.');\n      return;\n    }\n    socket.emit('textInput', text);\n    const userMessage = {\n      id: Date.now().toString(),\n      content: text,\n      role: 'user',\n      timestamp: new Date()\n    };\n    setState(prev => ({\n      ...prev,\n      messages: [...prev.messages, userMessage],\n      isLoading: true\n    }));\n  };\n  const handleRecommendMessage = message => {\n    const assistantMessage = {\n      id: Date.now().toString(),\n      content: {\n        message,\n        articles: []\n      },\n      role: 'assistant',\n      timestamp: new Date()\n    };\n    setState(prev => ({\n      ...prev,\n      messages: [...prev.messages, assistantMessage],\n      isLoading: false\n    }));\n  };\n  return {\n    messages: state.messages,\n    isLoading: state.isLoading,\n    error: state.error,\n    sendMessage,\n    handleRecommendMessage\n  };\n};\n_s(useChat, \"Unj0Cf2yc/7IKVSt2VQoOQR4csg=\");","map":{"version":3,"names":["useState","useEffect","useRef","socket","useChat","_s","state","setState","messages","isLoading","error","processedTextEventIds","Set","processedAudioEventIds","connect","prev","on","err","console","disconnect","sendMessage","text","connected","emit","userMessage","id","Date","now","toString","content","role","timestamp","handleRecommendMessage","message","assistantMessage","articles"],"sources":["/Users/komasz/Documents/GitHub/ai-voice/frontend/src/hooks/useChat.ts"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\nimport { socket } from '../services/socket';\nimport { BotMessage, ChatState, UserMessage } from '@/types/chat';\n\nexport const useChat = () => {\n  const [state, setState] = useState<ChatState>({\n    messages: [],\n    isLoading: false,\n    error: null,\n  });\n\n  const processedTextEventIds = useRef<Set<string>>(new Set());\n  const processedAudioEventIds = useRef<Set<string>>(new Set());\n\n  useEffect(() => {\n    socket.connect();\n    setState(prev => ({ ...prev, isLoading: true }));\n\n    socket.on('connect', () => {\n      setState(prev => ({ ...prev, isLoading: false }));\n    });\n\n    /*\n    socket.on('audioInputTranscript', (data: any) => {\n      if (data.event_id) {\n        if (processedAudioEventIds.current.has(data.event_id)) {\n          return;\n        }\n        processedAudioEventIds.current.add(data.event_id);\n      }\n\n      const userMessage: UserMessage = {\n        id: Date.now().toString(),\n        content: data.transcript,\n        role: 'user',\n        timestamp: new Date(),\n      };\n\n      setState(prev => ({\n        ...prev,\n        messages: [...prev.messages, userMessage],\n      }));\n    });\n\n    socket.on('textTranscript', (data: any) => {\n      if (processedTextEventIds.current.has(data.event_id)) {\n        return;\n      }\n      processedTextEventIds.current.add(data.event_id);\n\n      const botMessage: BotMessage = {\n        id: (Date.now() + 1).toString(),\n        content: {\n          message: data.part?.transcript || '(no text)',\n          articles: [],\n        },\n        role: 'assistant',\n        timestamp: new Date(),\n      };\n\n      setState(prev => ({\n        ...prev,\n        messages: [...prev.messages, botMessage],\n        isLoading: false,\n      }));\n    });\n    */\n\n    socket.on('connect_error', err => {\n      console.error('Socket connect_error:', err);\n      setState(prev => ({\n        ...prev,\n        error: 'Unable to connect to Socket.io',\n        isLoading: false,\n      }));\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n\n  const sendMessage = (text: string) => {\n    if (!socket.connected) {\n      console.error('Socket is not connected.');\n      return;\n    }\n\n    socket.emit('textInput', text);\n\n    const userMessage: UserMessage = {\n      id: Date.now().toString(),\n      content: text,\n      role: 'user',\n      timestamp: new Date(),\n    };\n\n    setState(prev => ({\n      ...prev,\n      messages: [...prev.messages, userMessage],\n      isLoading: true,\n    }));\n  };\n\n  const handleRecommendMessage = (message: string) => {\n    const assistantMessage: BotMessage = {\n      id: Date.now().toString(),\n      content: { message, articles: [] },\n      role: 'assistant',\n      timestamp: new Date(),\n    };\n\n    setState(prev => ({\n      ...prev,\n      messages: [...prev.messages, assistantMessage],\n      isLoading: false,\n    }));\n  };\n\n  return {\n    messages: state.messages,\n    isLoading: state.isLoading,\n    error: state.error,\n    sendMessage,\n    handleRecommendMessage,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}